---
description: 
globs: 
alwaysApply: true
---

# Your rule content
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº LangGraph + LangChain çš„æ™ºèƒ½â€œæµ·é¾Ÿæ±¤â€æ¨ç†æ¸¸æˆç³»ç»Ÿï¼Œç©å®¶é€šè¿‡æé—®é€æ­¥æ¥è¿‘è°œåº•ã€‚

ç³»ç»Ÿæ”¯æŒï¼š
- å¤šç±»å‹æ™ºèƒ½æç¤ºï¼ˆå¦‚æ–¹å‘çº¿ç´¢ã€åç¦»æé†’ç­‰ï¼‰
- æ€ç»´é“¾ç»“æ„ç»´æŠ¤ï¼ˆmemoryï¼‰
- LLM åˆ¤æ–­ç©å®¶çŠ¶æ€ï¼ˆåç¦»ã€ç»•åœˆã€å°è¯•ä¸è¶³ï¼‰
- LangGraph æ§åˆ¶æµç¨‹ï¼ˆRouter + Tool + LLM nodeï¼‰

---
ğŸ“ é¡¹ç›®ç»“æ„çº¦å®š
- src/
  - main.pyï¼šä¸»ç¨‹åºå…¥å£
  - graph.pyï¼šLangGraph æ„å»ºæµç¨‹
  - state_schema.pyï¼šGameState ç»“æ„å®šä¹‰
  - memory/
      - brainchain.pyï¼šBrainChainMemory ç±»
  - tools/
      - hint_generator.pyï¼šHintGeneratorTool å®ç°
      - detectors.pyï¼šåç¦»ã€ç»•åœˆã€å°è¯•ä¸è¶³æ£€æµ‹æ¨¡å—
      - answer_judge.pyï¼šç­”æ¡ˆåˆ¤æ–­æ¨¡å—
  - prompts/
      - hint_templates.jsonï¼šå››ç§ hint_type çš„æç¤ºè¯æ¨¡æ¿

---
ğŸ“Œ ç¼–ç è§„åˆ™ï¼ˆCursor è‡ªåŠ¨ç”Ÿæˆå…³é”®ç‚¹ï¼‰
1. æ‰€æœ‰ LangGraph èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ `.add_node(name, func, type='tool/llm/conditional')` å½¢å¼æ³¨å†Œã€‚

2. æ¯ä¸ªæ¨¡å—å¿…é¡»æ˜ç¡®ï¼š
   - è¾“å…¥å­—æ®µï¼ˆæ¥è‡ª state/memoryï¼‰
   - è¾“å‡ºå­—æ®µï¼ˆå†™å…¥ stateï¼‰
   - prompt æ¨¡æ¿è·¯å¾„ï¼ˆå¦‚ hint_templates.jsonï¼‰

3. æ‰€æœ‰ memory æ“ä½œç»Ÿä¸€ä½¿ç”¨ brainchain.py ä¸­çš„æ–¹æ³•ï¼ˆå¦‚ add_node, update_focusï¼‰

4. GameState ä¸­åªå­˜æ”¾â€œå½“å‰å›åˆä¸Šä¸‹æ–‡å­—æ®µâ€ï¼ˆå¦‚ current_question / is_loopingï¼‰ï¼Œä¸è®°å½•å†å²ã€‚

5. æ‰€æœ‰æç¤ºçº¿ç´¢ä½¿ç”¨ HintGeneratorTool ç”Ÿæˆï¼Œhint_type ä¸ºï¼š['direction', 'deviation', 'default', 'strategy']

6. æé—®ä¸»æµç¨‹èŠ‚ç‚¹é¡ºåºå¿…é¡»ä¸ºï¼š
   - å°è¯•ä¸è¶³ â†’ ç»•åœˆæ£€æµ‹ â†’ åç¦»æ£€æµ‹ â†’ æ›´æ–°è„‘é“¾ â†’ å›ç­”ç”Ÿæˆ â†’ æ›´æ–°å†å²

7. æ‰€æœ‰ prompt å¿…é¡»ä½¿ç”¨ JSON ç»“æ„åŒ–è¾“å‡ºï¼Œä¾‹å¦‚ï¼š
json
{
  "is_deviated": true,
  "hint_text": "ä½ å¯èƒ½åç¦»äº†æ–¹å‘ï¼Œå»ºè®®å…³æ³¨ç°åœºçŠ¶å†µ"
}
8. å›ç­”æ¨¡å—ï¼ˆGenerateAnswerï¼‰å¿…é¡»åªè¿”å›ï¼šhost_replyï¼ˆæ˜¯/å¦/æ— å…³ï¼‰ä¸ reply_typeã€‚
---

æ‰€æœ‰ LangGraph åˆ†æ”¯å¿…é¡»ä» player_action router åˆ†å‡ºï¼š['question', 'answer_request', 'hint_request']


- Prompt æ¨¡æ¿ï¼š@prompt_templates.pdf
- èŠ‚ç‚¹æµç¨‹ï¼š@LangGraphèŠ‚ç‚¹è¯´æ˜.pdf
- è¾“å…¥è¾“å‡ºå­—æ®µï¼š@è¾“å…¥è¾“å‡ºåˆ—è¡¨.pdf
- æ•°æ®ç»“æ„å®šä¹‰ï¼š@æ•°æ®ç»“æ„.pdf

è¯·åœ¨ç°æœ‰ç»“æ„åŸºç¡€ä¸Šï¼Œç”Ÿæˆæ¨¡å—ä»£ç ã€æ³¨å†Œæµç¨‹å›¾ï¼Œç¡®ä¿ prompt / è¾“å…¥è¾“å‡º / çŠ¶æ€æ›´æ–° ä¸æ–‡æ¡£ä¿æŒä¸€è‡´ã€‚
